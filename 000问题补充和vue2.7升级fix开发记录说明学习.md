[toc]

## 升级 vue2.6 到 vue2.7

使用 npm

### 删除 vue-compiler,除非使用@vue/test-utils

### 版本 vuecli-serve 升级支持

（1）将本地 @vue/cli-xxx 依赖项升级到主要版本范围内的最新版本（如果适用）

对于 v4：~4.5.18

对于 v5：~5.0.6

### 升级 eslint 相关

```
    "eslint": "^8.18.0",
    "eslint-plugin-vue": "^9.1.1",

```

[toc]

项目架构远程地址记录：
[远程 processOn 的记录分支同步](https://www.processon.com/mindmap/6316a2261efad46b1f5704ef)

## 1.CDN 引入实现，性能优化考虑 webpack

（1）第一种方式：

- 修改 HTML 页面，增加如下

```
    <!-- TODO:生成引入CDN的关键代码部分 -->
<!-- require cdn assets js -->
<% for (var i in htmlWebpackPlugin.options.cdn && htmlWebpackPlugin.options.cdn.js) { %>
    <script type="text/javascript" src="<%= htmlWebpackPlugin.options.cdn.js[i] %>"></script>
<% } %>
```

- 增加 webpack 的配置如下

```
const assetsCDN = {
  // webpack build externals
  externals: {
    vue: 'Vue',
    'vue-router': 'VueRouter',
    vuex: 'Vuex',
    axios: 'axios',
    nprogress: 'NProgress',
    clipboard: 'ClipboardJS',
    '@antv/data-set': 'DataSet',
    'js-cookie': 'Cookies'
  },
  css: [
  ],
  js: [
    '//cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.min.js',
    '//cdn.jsdelivr.net/npm/vue-router@3.3.4/dist/vue-router.min.js',
    '//cdn.jsdelivr.net/npm/vuex@3.4.0/dist/vuex.min.js',
    '//cdn.jsdelivr.net/npm/axios@0.19.2/dist/axios.min.js',
    '//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js',
    '//cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js',
    '//cdn.jsdelivr.net/npm/@antv/data-set@0.11.4/build/data-set.min.js',
    '//cdn.jsdelivr.net/npm/js-cookie@2.2.1/src/js.cookie.min.js'
  ]
}

  chainWebpack: config => {
    // 生产环境下使用CDN
    if (isProd) {
      config.plugin('html')
        .tap(args => {
          args[0].cdn = assetsCDN
        return args
      })
    }
```

(2)方式 2：增加插件：webpack-cdn-plugin，这里支持 webpack4.x

```
使用两个插件
const HtmlWebpackPlugin = require('html-webpack-plugin');
const WebpackCdnPlugin = require('webpack-cdn-plugin');
简单这样写即可
 plugins: [
    new HtmlWebpackPlugin(),
    new WebpackCdnPlugin({
      modules: [
        {
          name: 'vue',
          var: 'Vue',
          path: 'dist/vue.runtime.min.js'
        },
        {
          name: 'vue-router',
          var: 'VueRouter',
          path: 'dist/vue-router.min.js'
        },
        {
          name: 'vuex',
          var: 'Vuex',
          path: 'dist/vuex.min.js'
        }
      ],
      publicPath: '/node_modules'
    })
  ]
};
```

## 2.env 配置 env.development

首先创建一个.env 文件放公共的配置汇总内容文件，

```
VUE_APP_PUBLIC_PATH=/
VUE_APP_NAME=Admin
VUE_APP_ROUTES_KEY=admin.routes
VUE_APP_PERMISSIONS_KEY=admin.permissions
VUE_APP_ROLES_KEY=admin.roles
VUE_APP_USER_KEY=admin.user
VUE_APP_SETTING_KEY=admin.setting
VUE_APP_TBAS_KEY=admin.tabs
VUE_APP_TBAS_TITLES_KEY=admin.tabs.titles
VUE_APP_API_BASE_URL=http://api.iczer.com
```

然后.env.development 就是区分不同的配置环境的文件。
这样写更优雅。

```
VUE_APP_API_BASE_URL=http://dev.iczer.com
```

## 3.vue-adnt-design 第三版

Vue vben admin

## 4.增加 upload 方法配置

重新设置 header，重新上传实现

```
export async function uploadFile(parmas) {
  return request(
    'url',
    'post', {
    headers: {
      "Content-Type": "multipart/form-data",
    },
    data: parmas
  }
  )
}
```

## 5.补充增加源码学习：promise 专题和 async-await 专题

判断一个函数是不是 promise 对象

### (1)promise 对象函数判断

```
function  isDef(v){
  return v!==undefined && v!==null
}

function  isPromise(val){
  return {
    isDef(val);
    typeof val.then === 'function' && typeof val.catch === 'function';

  }
}

```

## 6.增加一个白名单机制

guards.js 文件中增加一个白名单机制。
name 使用正常的 router 路由

### 补充 vue-router 的路由 name 和 path 使用区别

## 7.增加 vue-compiler 后

建议不要增加这个，异常
vue These dependencies were not found: \* core-js/modules/es.array.iterator in ./node_modules/@babe
这里统一使用 yarn 安装工具，删除缓存方法：yarn cache clean --f

### (1)方法 1：重新删除项目后，重新安装依赖，

## 8.升级 eslint 和 eslint-plugin-vue 后出现：Parsing error: require() of ES Module

这个是一个 eslint 问题，将 babel-eslint 替换成@bable/eslint-parser 即可

```
module.exports = {
    root: true,
    env: {
        node: true
    },
    'extends': [
        'plugin:vue/essential',
        'eslint:recommended'
    ],
    rules: {
        'no-console': process.env.NODE_ENV === 'production' ? 'error' : 'off',
        'no-debugger': process.env.NODE_ENV === 'production' ? 'error' : 'off'
    },
    parserOptions: {
        parser: '@babel/eslint-parser'
    }
}

```

## 9.引入 ali-oss 但是没有使用，

```
我们可以尝试使用 ali-oss 功能？？？
```
